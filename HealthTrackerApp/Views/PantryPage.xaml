<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="HealthTrackerApp.Views.PantryPage"
             xmlns:viewmodel="clr-namespace:HealthTrackerApp.ViewModels"
             Title="Lao vaade"
             BackgroundColor="#E1BEE7">

    <ContentPage.BindingContext>
        <viewmodel:PantryViewModel />
    </ContentPage.BindingContext>

    <ScrollView>
        <VerticalStackLayout Spacing="20" Padding="20">

            <Label Text="ðŸ  Lao vaade â€“ koduste toiduainete haldus"
                   FontSize="22"
                   FontAttributes="Bold"
                   TextColor="#4A148C" />

            <!-- Uue toiduaine lisamine -->
            <Frame CornerRadius="15"
                   BackgroundColor="#F3E5F5"
                   BorderColor="#E1BEE7"
                   Padding="20">
                <VerticalStackLayout Spacing="15">
                    <Label Text="âž• Lisa toiduaine"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="#4A148C" />

                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="10" RowSpacing="10">
                        <!-- Nimi -->
                        <Entry Grid.Row="0" Grid.ColumnSpan="2"
                               Text="{Binding NewName}"
                               Placeholder="Nimi (nt: piim, muna, pasta...)"
                               BackgroundColor="#F5F5F5"
                               TextColor="#212121"
                               ClearButtonVisibility="WhileEditing" />

                        <!-- Kogus -->
                        <Entry Grid.Row="1" Grid.Column="0"
                               Text="{Binding NewQuantity}"
                               Placeholder="Kogus"
                               Keyboard="Numeric"
                               BackgroundColor="#F5F5F5"
                               TextColor="#212121" />

                        <!-- Ãœhik -->
                        <Picker Grid.Row="1" Grid.Column="1"
                                Title="Ãœhik"
                                ItemsSource="{Binding UnitOptions}"
                                SelectedItem="{Binding NewUnit}"
                                BackgroundColor="#F5F5F5"
                                TextColor="#212121" />

                        <!-- Kategooria -->
                        <Picker Grid.Row="2" Grid.Column="0"
                                Title="Kategooria"
                                ItemsSource="{Binding CategoryOptions}"
                                SelectedItem="{Binding NewCategory}"
                                BackgroundColor="#F5F5F5"
                                TextColor="#212121" />

                        <!-- Lisa nupp -->
                        <Button Grid.Row="2" Grid.Column="1"
                                Text="+"
                                Command="{Binding AddItemCommand}"
                                BackgroundColor="#9C27B0"
                                TextColor="White"
                                FontSize="18"
                                FontAttributes="Bold"
                                CornerRadius="10"
                                HeightRequest="50"
                                WidthRequest="50" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Tabel / nimekiri -->
            <Frame CornerRadius="15"
                   BackgroundColor="#F3E5F5"
                   BorderColor="#E1BEE7"
                   Padding="20">
                <VerticalStackLayout Spacing="15">
                    <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
                        <Label Text="Toode" FontSize="14" FontAttributes="Bold" TextColor="#4A148C" />
                        <Label Grid.Column="1" Text="Kogus" FontSize="14" FontAttributes="Bold" TextColor="#4A148C" HorizontalTextAlignment="Center" />
                        <Label Grid.Column="2" Text="Staatus" FontSize="14" FontAttributes="Bold" TextColor="#4A148C" HorizontalTextAlignment="Center" />
                    </Grid>

                    <CollectionView ItemsSource="{Binding Items}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame CornerRadius="10"
                                       BackgroundColor="#E1BEE7"
                                       BorderColor="#CE93D8"
                                       Padding="12"
                                       Margin="0,0,0,8">
                                    <Grid ColumnDefinitions="*,Auto,Auto,Auto" ColumnSpacing="10" VerticalOptions="Center">

                                        <!-- Toode -->
                                        <Label Grid.Column="0"
                                               Text="{Binding Name}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="#4A148C">
                                            <Label.Triggers>
                                                <DataTrigger TargetType="Label" Binding="{Binding IsOutOfStock}" Value="True">
                                                    <Setter Property="TextDecorations" Value="Strikethrough" />
                                                    <Setter Property="TextColor" Value="#9E9E9E" />
                                                </DataTrigger>
                                            </Label.Triggers>
                                        </Label>

                                        <!-- Kogus (-, vÃ¤Ã¤rtus, +) -->
                                        <HorizontalStackLayout Grid.Column="1" Spacing="6" VerticalOptions="Center">
                                            <Button Text="âˆ’"
                                                    FontSize="16"
                                                    WidthRequest="36"
                                                    HeightRequest="36"
                                                    CornerRadius="8"
                                                    BackgroundColor="#F3E5F5"
                                                    TextColor="#4A148C"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:PantryViewModel}}, Path=DecreaseCommand}"
                                                    CommandParameter="{Binding .}" />

                                            <Label Text="{Binding QuantityDisplay}"
                                                   FontSize="14"
                                                   TextColor="#4A148C"
                                                   VerticalOptions="Center"
                                                   HorizontalTextAlignment="Center"
                                                   WidthRequest="80" />

                                            <Button Text="+"
                                                    FontSize="16"
                                                    WidthRequest="36"
                                                    HeightRequest="36"
                                                    CornerRadius="8"
                                                    BackgroundColor="#F3E5F5"
                                                    TextColor="#4A148C"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:PantryViewModel}}, Path=IncreaseCommand}"
                                                    CommandParameter="{Binding .}" />
                                        </HorizontalStackLayout>

                                        <!-- Staatus -->
                                        <Button Grid.Column="2"
                                                Text="{Binding StatusDisplay}"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:PantryViewModel}}, Path=ToggleOutOfStockCommand}"
                                                CommandParameter="{Binding .}"
                                                FontSize="13"
                                                CornerRadius="10"
                                                Padding="10,6">
                                            <Button.Triggers>
                                                <DataTrigger TargetType="Button" Binding="{Binding IsOutOfStock}" Value="True">
                                                    <Setter Property="BackgroundColor" Value="#F8BBD0" />
                                                    <Setter Property="TextColor" Value="#880E4F" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Button" Binding="{Binding IsOutOfStock}" Value="False">
                                                    <Setter Property="BackgroundColor" Value="#E1BEE7" />
                                                    <Setter Property="TextColor" Value="#4A148C" />
                                                </DataTrigger>
                                            </Button.Triggers>
                                        </Button>

                                        <!-- Kustuta -->
                                        <Button Grid.Column="3"
                                                Text="ðŸ—‘ï¸"
                                                BackgroundColor="Transparent"
                                                TextColor="#F44336"
                                                FontSize="16"
                                                WidthRequest="40"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:PantryViewModel}}, Path=DeleteCommand}"
                                                CommandParameter="{Binding .}" />
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <Label Text="{Binding Items.Count, StringFormat='Kokku: {0} toodet'}"
                           FontSize="14"
                           TextColor="#6A1B9A"
                           HorizontalOptions="Center" />
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
